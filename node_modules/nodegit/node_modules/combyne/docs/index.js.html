<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Exposed module for creating and rendering templates.
 *
 * @module index
 * @requires grammar
 * @requires tokenizer
 * @requires tree
 * @requires compiler
 * @requires shared/register_partial
 * @requires shared/register_filter
 * @requires utils/type
 */
define(function(require, exports, module) {
  "use strict";

  var Grammar = require("./grammar");
  var Tokenizer = require("./tokenizer");
  var Tree = require("./tree");
  var Compiler = require("./compiler");

  // Shared.
  var registerPartial = require("./shared/register_partial");
  var registerFilter = require("./shared/register_filter");

  // Utils.
  var type = require("./utils/type");
  var defaults = require("./utils/defaults");

  // These are the custom delimiters that will always be falled back on for
  // every template.  They can be overwritten in the settings object.
  var defaultDelimiters = {
    START_RAW: "{{{",
    END_RAW: "}}}",
    START_PROP: "{{",
    END_PROP: "}}",
    START_EXPR: "{%",
    END_EXPR: "%}",
    COMMENT: "--",
    FILTER: "|"
  };

  /**
   * Represents a Combyne template.
   *
   * @class Combyne
   * @param {string} template - The template to compile.
   * @param {object} data - Optional data to compile.
   * @memberOf module:index
   */
  function Combyne(template, data) {
    // Allow this method to run standalone.
    if (!(this instanceof Combyne)) {
      return new Combyne(template, data);
    }

    // Expose the template for easier accessing and mutation.
    this.template = template;

    // Default the data to an empty object.
    this.data = data || {};

    // Internal use only.  Stores the partials and filters.
    this._partials = {};
    this._filters = {};

    // Ensure the template is a String.
    if (type(this.template) !== "string") {
      throw new Error("Template must be a String.");
    }

    // Normalize the delimiters with the defaults, to ensure a full object.
    var delimiters = defaults(Combyne.settings.delimiters, defaultDelimiters);

    // Create a new grammar with the delimiters.
    var grammar = new Grammar(delimiters).escape();

    // Break down the template into a series of tokens.
    var stack = new Tokenizer(this.template, grammar).parse();

    // Take the stack and create something resembling an AST.
    var tree = new Tree(stack).make();

    // Expose the internal tree and stack.
    this.tree = tree;
    this.stack = stack;

    // Compile the template function from the tree.
    this.compiler = new Compiler(tree);

    // Update the source.
    this.source = this.compiler.source;
  }

  /**
   * Register a partial into the template.
   *
   * @memberOf module:index.Combyne
   * @see {@link module:shared/register_partial}
   */
  Combyne.prototype.registerPartial = registerPartial;

  /**
   * Register a filter into the template.
   *
   * @memberOf module:index.Combyne
   * @see {@link module:shared/register_filter}
   */
  Combyne.prototype.registerFilter = registerFilter;

  /**
   * Expose the global template settings.
   *
   * @memberOf module:index.Combyne
   * @type {object}
   */
  Combyne.settings = {};

  /**
   * Render the template with data.
   *
   * @memberOf module:index.Combyne
   * @param {object} data - The data to provide to the template.
   * @return {string} Rendered template.
   */
  Combyne.prototype.render = function(data) {
    // Override the template data if provided.
    this.data = data || this.data;

    // Execute the template function with the correct data.
    return this.compiler.func(this.data, this._partials, this._filters);
  };

  /**
   * Attach the version number.
   *
   * @memberOf module:index.Combyne
   * @type {string}
   */
  Combyne.VERSION = "0.5.1";

  module.exports = Combyne;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-compiler.html">compiler</a></li><li><a href="module-grammar.html">grammar</a></li><li><a href="module-index.html">index</a></li><li><a href="encode.html">shared/encode</a></li><li><a href="register_filter.html">shared/register_filter</a></li><li><a href="register_partial.html">shared/register_partial</a></li><li><a href="module-tokenizer.html">tokenizer</a></li><li><a href="module-tree.html">tree</a></li><li><a href="create_object.html">utils/create_object</a></li><li><a href="defaults.html">utils/defaults</a></li><li><a href="escape_delimiter.html">utils/escape_delimiter</a></li><li><a href="map_.html">utils/map</a></li><li><a href="type.html">utils/type</a></li></ul><h3>Classes</h3><ul><li><a href="module-compiler.Compiler.html">Compiler</a></li><li><a href="module-grammar.Grammar.html">Grammar</a></li><li><a href="module-index.Combyne.html">Combyne</a></li><li><a href="module-tokenizer.Tokenizer.html">Tokenizer</a></li><li><a href="module-tree.Tree.html">Tree</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha9</a> on Mon Sep 15 2014 21:36:09 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
